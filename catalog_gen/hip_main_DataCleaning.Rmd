---
title: "Hipparcos Data Cleaning"
author: "Christian Bueno"
date: "June 30, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Reading and checking the data

First we read in the data (which had "|" as separators).

```{r cache=TRUE} 
data <- read.table("hip_main.dat", sep="|")
```

We have `r nrow(data)` rows and `r ncol(data)` columns. Notice that the first column is full of "H"s, which isn't particularly useful.

```{r}
summary(data[,1])
```

Next observe that the second column is more or less a row number, however many such numbers are missing and there are also jumps.

```{r cache=TRUE}
hist(data[,2], breaks = 450)
plot(x=seq(nrow(data)), y=data[,2], xlab="Actual row number")
```

Next, we look for missing values.

```{r}
missingVal <- is.na(data)
```

There are a total of `r sum(missingVal)` missing values in the dataset. To get a better understand let us look at which columns are missing values and how many.

```{r}
missingVal_Col <- colSums(missingVal)
```

There are `r sum(missingVal_Col!=0)` columns with missing values, and `r sum(missingVal_Col==0)` complete columns. Here they are:

```{r}
#Columns with missing values
which(missingVal_Col!=0)
#Complete columns
which(missingVal_Col==0)
```

Here's a plot of how many values are missing per column (for the columns which are missing values).

```{r}
plot(missingVal_Col[missingVal_Col!=0], xlab="Column index", ylab="# of missing values")
```

Some of these missing columns are more problematic than others. In particular, we are interested in the 2nd, 6th, 9th, 10th, and 12th columns. The number missing values for those columsn are

```{r echo=FALSE}
imp_idx <- c(2,6,9,10,12)
data.frame( ColumnContent = c('HIP Identifier','Magnitude','RAdeg','DEdeg','Parallax'), TotalMissingVal = colSums(is.na(data[,imp_idx])) )
```

As expected the HIP identifier has no null values, but RAdeg, DEdeg and Parallax have `r sum(is.na(data[,9]))` missing values and the star Magnitude has just `r sum(is.na(data[,6]))`. It turns out all of the `r sum(is.na(data[,9]))` missing values in the last three variables occur in matching rows.

```{r}
all( (is.na(data[,9]) == is.na(data[,10])) & (is.na(data[,10]) == is.na(data[,12])) )
```

And lastly the row in which there is missing magnitude data is `r which(is.na(data[,6]))`. Turns out that this is `r which(is.na(data[,6])) %in% which(is.na(data[,9]))`.

To move forward, we will concern ourselves with just those special columns, and it would help to be able to refer to them by name. So we do the following:


```{r}
#The `important' data.
data_imp <- data[,imp_idx]
#Label the columns
colnames(data_imp) <- c("HIP","Vmag","RAdeg","DEdeg","Plx")
```

## Exploratory Data Analysis

Here is a density plot of the stars

```{r cache=TRUE}
smoothScatter(data_imp$DEdeg ~ data_imp$RAdeg, xlab ='RAdeg', ylab='DEdeg', main='2D Star Density')
```